# Component Plan: Real Financial Reports

> **Goal**: Replace hardcoded mock data in Financial Dashboards with real aggregations from the `Order`, `Quote`, and `User` tables.

## 1. Analysis of Requirements

### 1.1 Seller Performance Report (`/finance/sellers`)
**Current Mock Data Fields:**
- `ordersCount`: Total confirmed orders.
- `quotesCount`: Total quotes created.
- `conversionRate`: `(orders / quotes) * 100`.
- `totalRevenue`: Sum of `totalCents` from confirmed orders.
- `averageTicket`: `totalRevenue / ordersCount`.
- `commission`: `totalRevenue * commissionRate` (need to define commission logic, likely flat % for now or user attribute).
- `trend`: Comparison with previous month (requires Date filtering).
- `rank`: Calculated based on revenue.

### 1.2 Architect Commission Report (`/finance/architects`)
**Current Data Needs:**
- `totalSales`: Revenue generated by customers linked to this architect.
- `commissionTotal`: `totalSales * architect.commissionRate`.
- `clientsCount`: Distinct customers who bought.

## 2. Infrastructure Changes (Backend)

### 2.1 Services
**`DashboardService` (upgrade)**
- Add method `getSellerPerformance(clinicId, filters)`:
  - Aggregate `Quote` grouped by `sellerId`.
  - Aggregate `Order` grouped by `sellerId`.
  - Join with `User` to get names.
- Add method `getArchitectPerformance(clinicId, filters)`:
  - Aggregate `Order` linked to `Customer.architectId`.

### 2.2 DTOs
- `GetFinancialReportDto`: `{ startDate?, endDate? }`

### 2.3 API Endpoints
- `GET /dashboard/finance/sellers` -> returns list of seller stats.
- `GET /dashboard/finance/architects` -> returns list of architect stats.

## 3. Frontend Implementation

### 3.1 Data Fetching
- Create `useFinancialReports` hook.
- Fetch data from new endpoints.

### 3.2 UI Updates
- **Sellers Page**: Replace `mockSellers` with real data.
- **Architects Page**: Replace generic data.
- **Filters**: Wire up the "Month/Year" picker to refresh data.

## 4. Verification Plan

1. **Seed Data**: Ensure we have orders for different sellers (we strictly have Admin/Seller in seed, need to generate activity for them).
2. **Manual Test**:
   - Create 2 quotes for "Vendedor". Confirm 1.
   - Check Report: Conversion 50%.
3. **Compare**: Values in report must match sum of Orders in `/orders`.
